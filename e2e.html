<!DOCTYPE html>
<style>
.e2e tr:nth-of-type(odd) {
}
.e2e tr:nth-of-type(even) {
	  /*filter: brightness(97%);*/
}
</style>

<script>
var jenkinsRoot = "https://jenkins.com.int.zone/";

var builds = [
	{ name: "GDPR", owner: "", job: "gdpr-backend/master/validate-and-promote", detectVersion: true},
	{ name: "IDP", owner: "", job: "idp-backend/master/validate-and-promote", detectVersion: true},
	{ name: "Rating Engine", owner: "", job: "ratingengine-backend/master/validate-and-promote", detectVersion: true},
	{ name: "UAM", owner: "", job: "uam/master/validate-and-promote", detectVersion: true},
];
var e2e = [
	{ name: "RE Refund CL", owner: "Ramil", job: "ratingengine-backend/master/tests/master/refund-policies-cancellation"},
	{ name: "RE Refund RN+CL", owner: "Ramil", job: "ratingengine-backend/master/tests/master/refund-policies-cancellation-with-renew"},
	{ name: "RE Refund CH", owner:"Ramil", job: "ratingengine-backend/master/tests/master/refund-policies-downsizing"},
	{ name: "RE Refund RN+CH", owner: "Ramil", job: "ratingengine-backend/master/tests/master/refund-policies-downsizing-with-renew"},
	{ name: "RE anonym", owner: "Ramil", job: "ratingengine-backend/master/tests/master/marketplace-anonymous-context"},
	{ name: "RE Transfer account", owner: "Temur", job: "bss/unstable/tests/master/transfer-account-with-re"},
	{ name: "RE Transfer subscription", owner: "Temur", job: "bss/unstable/tests/master/transfer-subscription-with-re"},
	{ name: "RE migrator", owner: "Artem", job: "ratingengine-backend/master/tests/master/ratingengine-migration"},
	{ name: "UAM bulk-accounts-import", owner: "Denis", job: "uam/master/tests/master/bulk-accounts-import"},
	{ name: "UAM customers-onboarding", owner: "Denis", job: "uam/master/tests/master/customers-onboarding"},
	{ name: "UAM reseller-management", owner: "Denis", job: "uam/master/tests/master/reseller-management"},
	{ name: "UAM performance", owner: "Dima", job: "trunk/tests/perftests-ng/perftest-uam-cnc"},
	{ name: "GDPR gdpr-management", owner: "Vlad", job: "gdpr-backend/master/tests/master/gdpr-management"},
	{ name: "GDPR gdpr-management-ui", owner: "Vlad", job: "gdpr-backend/master/tests/master/gdpr-management-ui"},
	{ name: "GDPR management srv", owner: "Vlad", job: "gdpr-backend/master/tests/master/gdpr-management-with-services"},
	{ name: "BSS password-policy", owner: "Dima", job: "bss/unstable/tests/master/password-policy"},
	{ name: "BSS UX1", owner: "Denis", job: "bss/unstable/tests/master/ux1"},
	{ name: "BSS Subscr maintenance", owner: "Denis", job: "bss/unstable/tests/master/subscription-maintenance" },
	{ name: "OSS gdpr", owner: "Vlad", job: "oss/unstable/tests/master/gdpr" },
	{ name: "OSS gdpr-privacy-notice", owner: "Vlad", job: "oss/unstable/tests/master/gdpr-privacy-notice" },
	{ name: "OSS license-management", owner: "Vlad", job: "oss/unstable/tests/master/license-management" },
	{ name: "OSS user-management-basic", owner: "Vlad", job: "oss/unstable/tests/master/user-management-basic" },
	{ name: "OSS user-management-advanced", owner: "Vlad", job: "oss/unstable/tests/master/user-management-advanced" },
	{ name: "OSS user-events-and-services", owner: "Dima", job: "oss/unstable/tests/master/user-events-and-services" },
	{ name: "OSS account-notes", owner: "Artem", job: "oss/unstable/tests/master/account-notes" },
	{ name: "IDP", owner:"Temur", job: "idp-backend/master/tests/master/idp" },
];

function jobUrl(job) {
	var dontMap = false;
	return jenkinsRoot + job.split("/").map(part => {return "job/" + part;}).join("/");
}

function imageUrl(job, detectVersion, buildParam) {
	return jenkinsRoot + "buildStatus/icon?job=" + encodeURIComponent(job) + (detectVersion ? "&subject=" + encodeURIComponent(`            \${params.${buildParam}}`): `&build=last`);
}

function buildA(job, isStable, buildParam) {
	var a = document.createElement('a');
	a.setAttribute("href", jobUrl(job));
	a.setAttribute("target","_blank");
	var img = document.createElement("img");
	img.setAttribute("src", imageUrl(job, isStable, buildParam));
	a.appendChild(img);
	return a;
}

const palette = ["LightCoral", "LightSalmon", "Gold", "YellowGreen", "PaleTurquoise", "Lavender", "LightSteelBlue"];

function* getColor() {
	for(color in palette) {
		yield palette[color];
	}
}

function onload() {
	var buildsRoot = document.getElementById("build");
	builds.forEach(function (data) {
		var row = buildsRoot.insertRow();
		row.insertCell().appendChild(document.createTextNode(data.name));
		var buildParam = data.buildParam || "BUILD_NAME";
		var detectVersion = data.detectVersion || false;
		row.insertCell().appendChild(buildA(data.job, detectVersion, buildParam));
	});

	var e2eRoot = document.getElementById("e2e");

	var colors = {};

	const colorGenerator = getColor()

	e2e.forEach(function (data) {
		var owner = data.owner || "";
		var color = colors[owner] || colorGenerator.next().value;
		colors[owner] = color;
		var row = e2eRoot.insertRow();
		row.style.cssText = `background-color: ${color}`;
		row.insertCell().appendChild(document.createTextNode(data.name));
		row.insertCell().appendChild(document.createTextNode(owner));
		var buildParam = data.buildParam || "BUILD_NAME";
		var detectVersion = data.detectVersion || false;
		row.insertCell().appendChild(buildA(data.job, detectVersion, buildParam));
	});

	console.log(colors);
}
</script>

<script type="text/javascript">
function sortTable(n, tableId) {
  var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
  table = document.getElementById(tableId);
  switching = true;
  // Set the sorting direction to ascending:
  dir = "asc";
  /* Make a loop that will continue until
  no switching has been done: */
  while (switching) {
    // Start by saying: no switching is done:
    switching = false;
    rows = table.rows;
    /* Loop through all table rows (except the
    first, which contains table headers): */
    for (i = 1; i < (rows.length - 1); i++) {
      // Start by saying there should be no switching:
      shouldSwitch = false;
      /* Get the two elements you want to compare,
      one from current row and one from the next: */
      x = rows[i].getElementsByTagName("TD")[n];
      y = rows[i + 1].getElementsByTagName("TD")[n];
      /* Check if the two rows should switch place,
      based on the direction, asc or desc: */
      if (dir == "asc") {
        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
          // If so, mark as a switch and break the loop:
          shouldSwitch = true;
          break;
        }
      } else if (dir == "desc") {
        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
          // If so, mark as a switch and break the loop:
          shouldSwitch = true;
          break;
        }
      }
    }
    if (shouldSwitch) {
      /* If a switch has been marked, make the switch
      and mark that a switch has been done: */
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
      // Each time a switch is done, increase this count by 1:
      switchcount ++;
    } else {
      /* If no switching has been done AND the direction is "asc",
      set the direction to "desc" and run the while loop again. */
      if (switchcount == 0 && dir == "asc") {
        dir = "desc";
        switching = true;
      }
    }
  }
}
</script>

<body onload="onload()" height="640">
	<table id="build">
		<tr>
		<!--
			<th onclick="sortTable(0, 'build')">Name</th>
			<th>Status</th>
		-->
		</tr>
	</table>
	<table id="e2e" class="e2e">
		<tr>
			<th onclick="sortTable(0, 'e2e')">Name</th>
			<th onclick="sortTable(1, 'e2e')">Owner</th>
			<th>Status</th>
		</tr>
	</table>
</body>
